<!-- çå‹µé ˜å–æˆåŠŸå½ˆçª— -->
<div *ngIf="showRewardModal" class="reward-modal-overlay" (click)="closeRewardModal()">
  <div class="reward-modal" (click)="$event.stopPropagation()">
    <div class="reward-modal-header">
      <h2 class="reward-title">ğŸ‰ çå‹µé ˜å–æˆåŠŸï¼</h2>
      <button class="close-btn" (click)="closeRewardModal()">Ã—</button>
    </div>
    <div class="reward-content" *ngIf="lastClaimedReward?.rewards">
      <div class="reward-items">
        <div *ngIf="rewardGold > 0" class="reward-item">
          <img src="/assets/game/gold_coin.png" alt="Gold" class="reward-icon" />
          <span class="reward-amount">+{{ rewardGold | number }}</span>
        </div>
        <div *ngIf="rewardPrompt > 0" class="reward-item">
          <img src="/assets/game/prompt.png" alt="Prompt" class="reward-icon" />
          <span class="reward-amount">+{{ rewardPrompt }}</span>
        </div>
        <div *ngIf="rewardPromptPower > 0" class="reward-item">
          <img src="/assets/game/prompt_power.png" alt="Prompt Power" class="reward-icon" />
          <span class="reward-amount">+{{ rewardPromptPower }}</span>
        </div>
        <div *ngIf="rewardExpPotion > 0" class="reward-item">
          <img src="/assets/game/exp_potion.png" alt="Exp Potion" class="reward-icon" />
          <span class="reward-amount">+{{ rewardExpPotion }}</span>
        </div>
        <div *ngIf="rewardEnergy > 0" class="reward-item">
          <img src="/assets/game/stamina.png" alt="Energy" class="reward-icon" />
          <span class="reward-amount">+{{ rewardEnergy }}</span>
        </div>
      </div>
      <button class="confirm-btn" (click)="closeRewardModal()">ç¢ºå®š</button>
    </div>
  </div>
</div>

<!-- è¼‰å…¥ä¸­ç‹€æ…‹ -->
<div *ngIf="isLoading" class="loading-container">
  <div class="loading-spinner"></div>
  <p class="loading-text">è¼‰å…¥æ¯æ—¥ä»»å‹™ä¸­...</p>
</div>

<!-- ç°½åˆ°æˆåŠŸå½ˆçª— -->
<div *ngIf="showCheckInModal" class="reward-modal-overlay" (click)="closeCheckInModal()">
  <div class="reward-modal" (click)="$event.stopPropagation()">
    <div class="reward-modal-header">
      <h2 class="reward-title">ğŸ‰ ç°½åˆ°æˆåŠŸï¼</h2>
      <button class="close-btn" (click)="closeCheckInModal()">Ã—</button>
    </div>
    <div class="reward-content">
      <p>{{ checkInMessage }}</p>
      <button class="confirm-btn" (click)="closeCheckInModal()">ç¢ºå®š</button>
    </div>
  </div>
</div>

<!-- ä¸»è¦å…§å®¹ -->
<div *ngIf="!isLoading && dailyStats" class="daily-quests-container">
  
  <!-- é ‚éƒ¨çµ±è¨ˆå¡ç‰‡ -->
  <div class="stats-overview">
    <div class="stats-card">
      <div class="stats-header">
        <h2 class="stats-title">
          <span class="title-icon">ğŸ“‹</span>
          æ¯æ—¥ä»»å‹™
        </h2>
        <div class="login-streak">
          <span class="streak-icon">ğŸ”¥</span>
          <span class="streak-text">é€£çºŒç™»å…¥ {{ dailyStats.login_streak }} å¤©</span>
        </div>
      </div>
      
      <div class="stats-summary">
        <div class="progress-ring">
          <div class="progress-circle">
            <div class="progress-fill" [style.--progress]="completionPercentage + '%'"></div>
            <div class="progress-text">
              <span class="progress-number">{{ completionPercentage | number:'1.0-1' }}%</span>
              <span class="progress-label">å®Œæˆåº¦</span>
            </div>
          </div>
        </div>
        
        <div class="stats-details">
          <div class="stat-item">
            <span class="stat-label">å·²å®Œæˆ</span>
            <span class="stat-value">{{ dailyStats.completed_quests }}/{{ dailyStats.total_quests }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">å·²é ˜å–</span>
            <span class="stat-value">{{ dailyStats.claimed_rewards }}/{{ dailyStats.total_quests }}</span>
          </div>
        </div>
      </div>
      
      <!-- ç°½åˆ°æŒ‰éˆ• -->
      <div class="checkin-section" *ngIf="canCheckIn">
        <button class="checkin-btn" (click)="checkIn()">
          <span class="checkin-icon">ğŸ“…</span>
          <span class="checkin-text">ç«‹å³ç°½åˆ°</span>
        </button>
      </div>
      
      <!-- å·²ç°½åˆ°æç¤º -->
      <div class="checked-in" *ngIf="!canCheckIn">
        <span class="checked-icon">âœ…</span>
        <span class="checked-text">ä»Šæ—¥å·²ç°½åˆ°</span>
      </div>
    </div>
  </div>

  <!-- ä»»å‹™åˆ—è¡¨ -->
  <div class="quests-section">
    <h3 class="section-title">
      <span class="title-icon">ğŸ¯</span>
      ä»Šæ—¥ä»»å‹™
      <span class="unclaimed-badge" *ngIf="hasUnclaimedRewards">æœ‰æœªé ˜å–çå‹µ</span>
    </h3>
    
    <div class="quests-list">
      <div *ngFor="let quest of dailyStats.quests" class="quest-card" [class.completed]="quest.is_completed" [class.claimed]="quest.is_claimed">
        
        <!-- ä»»å‹™é ­éƒ¨ -->
        <div class="quest-header">
          <div class="quest-info">
            <div class="quest-icon" [style.color]="getQuestColor(quest.quest.quest_type)">
              {{ getQuestIcon(quest.quest.quest_type) }}
            </div>
            <div class="quest-details">
              <h4 class="quest-name">{{ quest.quest.name }}</h4>
              <p class="quest-description">{{ quest.quest.description }}</p>
            </div>
          </div>
          
          <div class="quest-status">
            <div *ngIf="quest.is_completed && quest.is_claimed" class="status-badge claimed">
              <span class="badge-icon">âœ…</span>
              <span class="badge-text">å·²é ˜å–</span>
            </div>
            <div *ngIf="quest.is_completed && !quest.is_claimed" class="status-badge ready">
              <span class="badge-icon">ğŸ</span>
              <span class="badge-text">å¯é ˜å–</span>
            </div>
            <div *ngIf="!quest.is_completed" class="status-badge progress">
              <span class="badge-text">é€²è¡Œä¸­</span>
            </div>
          </div>
        </div>

        <!-- é€²åº¦æ¢ -->
        <div class="quest-progress">
          <div class="progress-info">
            <span class="progress-current">{{ quest.current_count }}/{{ quest.quest.target_count }}</span>
            <span class="progress-percentage">{{ quest.progress_percentage | number:'1.0-1' }}%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" 
                 [class]="getProgressBarClass(quest)"
                 [style.width.%]="quest.progress_percentage">
            </div>
          </div>
        </div>

        <!-- çå‹µå€åŸŸ -->
        <div class="quest-rewards">
          <div class="rewards-list">
            <span class="rewards-label">çå‹µï¼š</span>
            <div class="reward-items">
              <div *ngFor="let reward of formatRewards(quest)" class="reward-tag">
                <img *ngIf="reward.type === 'gold'" src="/assets/game/gold_coin.png" alt="Gold" class="reward-icon" />
                <img *ngIf="reward.type === 'prompt'" src="/assets/game/prompt.png" alt="Prompt" class="reward-icon" />
                <img *ngIf="reward.type === 'prompt_power'" src="/assets/game/prompt_power.png" alt="Prompt Power" class="reward-icon" />
                <img *ngIf="reward.type === 'exp_potion'" src="/assets/game/exp_potion.png" alt="Exp Potion" class="reward-icon" />
                <img *ngIf="reward.type === 'energy'" src="/assets/game/stamina.png" alt="Energy" class="reward-icon" />
                <span class="reward-amount">+{{ reward.amount }}</span>
              </div>
            </div>
          </div>
          
          <button *ngIf="quest.is_completed && !quest.is_claimed" 
                  class="claim-btn"
                  (click)="claimReward(quest)">
            <span class="claim-icon">ğŸ</span>
            <span class="claim-text">é ˜å–çå‹µ</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- åº•éƒ¨æç¤º -->
  <div class="daily-tips">
    <div class="tip-card">
      <span class="tip-icon">ğŸ’¡</span>
      <div class="tip-content">
        <h4 class="tip-title">å°è²¼å£«</h4>
        <ul class="tip-list">
          <li>æ¯æ—¥ä»»å‹™æ–¼æ¯å¤© 00:00 é‡ç½®</li>
          <li>å®Œæˆä»»å‹™å¾Œè¨˜å¾—é ˜å–çå‹µ</li>
          <li>é€£çºŒç™»å…¥å¯ç²å¾—é¡å¤–çå‹µ</li>
          <li>åƒèˆ‡å°æˆ°å’Œå¬å–šéƒ½èƒ½ç²å¾—ä»»å‹™é€²åº¦</li>
        </ul>
      </div>
    </div>
  </div>
</div>

<!-- ç©ºç‹€æ…‹ -->
<div *ngIf="!isLoading && !dailyStats" class="empty-state">
  <div class="empty-icon">ğŸ“‹</div>
  <h3 class="empty-title">æš«ç„¡æ¯æ—¥ä»»å‹™</h3>
  <p class="empty-message">è«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«å®¢æœ</p>
  <button class="retry-btn" (click)="loadDailyStats()">é‡æ–°è¼‰å…¥</button>
</div>