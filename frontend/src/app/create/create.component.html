<div *ngIf="isGenerating" class="overlay-loading">
  <div class="magical-portal">
    <div class="magic-circle">
      <div class="inner-circle"></div>
      <div class="runes">✦ ✧ ✦ ✧ ✦ ✧</div>
    </div>
    <div class="energy-particles">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>
    <div class="overlay-text">
      <span class="text-glow">召喚魔法進行中...</span>
      <div class="progress-dots">
        <span>●</span><span>●</span><span>●</span>
      </div>
    </div>
  </div>
</div>

<div *ngIf="showSuccessModal" class="modal-success">
  <div class="modal-content">
    <h2 class="modal-title">英雄誕生！</h2>
    <div class="modal-character-preview">
      <app-character-card *ngIf="generatedCharacter" [character]="generatedCharacter"></app-character-card>
    </div>
    <div class="modal-actions">
      <button class="game-btn" (click)="closeModal()">確定</button>
    </div>
  </div>
</div>

<div class="game-bg">
  <div class="magical-background">
    <div class="floating-orbs">
      <div class="orb orb-1"></div>
      <div class="orb orb-2"></div>
      <div class="orb orb-3"></div>
    </div>
  </div>
  <div class="container mx-auto px-4 py-8">
    <div class="title-section">
      <!-- <div class="title-ornament">英雄召喚祭壇</div> -->
      <h1 class="magical-title">
        <span class="title-text">創造你的傳奇英雄</span>
        <div class="title-underline"></div>
      </h1>
      <p class="title-subtitle">運用古老的召喚魔法，賦予你的英雄生命與力量</p>
    </div>
    <div class="max-w-4xl mx-auto">
      <!-- 召喚方式選擇 -->
      <div class="summon-tabs">
        <button 
          (click)="mode = 'normal'" 
          [class.active]="mode==='normal'" 
          class="summon-tab">
          <div class="tab-icon">◉</div>
          <div class="tab-content">
            <div class="tab-title">普通召喚</div>
            <div class="tab-desc">快速創造英雄</div>
          </div>
        </button>
        <button 
          (click)="mode = 'advanced'" 
          [class.active]="mode==='advanced'" 
          class="summon-tab">
          <div class="tab-icon">✦</div>
          <div class="tab-content">
            <div class="tab-title">高級召喚</div>
            <div class="tab-desc">客製化你的英雄</div>
          </div>
        </button>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- 召喚法陣 -->
        <div class="summon-circle-container">
          <div class="summon-circle">
            <div class="circle-outer"></div>
            <div class="circle-inner"></div>
            <div class="circle-runes">
              <div class="rune">✦</div>
              <div class="rune">◉</div>
              <div class="rune">✧</div>
              <div class="rune">◈</div>
            </div>
            <div class="circle-center">
              <div class="center-icon">{{ mode==='normal' ? '◉' : '✦' }}</div>
            </div>
          </div>
          
          <div class="summon-form">
            <h2 class="form-title">
              {{ mode==='normal' ? '普通召喚法陣' : '高級召喚法陣' }}
            </h2>
          <!-- 普通召喚 -->
          <ng-container *ngIf="mode==='normal'">
            <div class="input-group">
              <label class="magic-label">
                <span class="label-icon">◈</span>
                <span class="label-text">英雄名字</span>
              </label>
              <div class="magic-input-container">
                <input 
                  type="text" 
                  [(ngModel)]="characterPrompt"
                  placeholder="例如：炒麵戰士、Shadow Ninja..."
                  class="magic-input"
                  [disabled]="isGenerating">
                <div class="input-glow"></div>
              </div>
              <p class="input-hint">
                輸入你的英雄名字，讓魔法為你創造獨特的戰士
              </p>
            </div>
          </ng-container>
          <!-- 高級召喚 -->
          <ng-container *ngIf="mode==='advanced'">
            <div class="input-group">
              <label class="magic-label">
                <span class="label-icon">◈</span>
                <span class="label-text">英雄名字</span>
              </label>
              <div class="magic-input-container">
                <input 
                  type="text" 
                  [(ngModel)]="advancedName" 
                  placeholder="請輸入英雄名字" 
                  class="magic-input" 
                  [disabled]="isGenerating">
                <div class="input-glow"></div>
              </div>
            </div>
            <div class="input-group">
              <label class="magic-label">
                <span class="label-icon">◎</span>
                <span class="label-text">英雄傳說</span>
              </label>
              <div class="magic-input-container">
                <textarea 
                  [(ngModel)]="advancedPrompt" 
                  rows="4" 
                  placeholder="描述你的英雄外觀、背景故事、特殊能力、武器裝備..." 
                  class="magic-input magic-textarea" 
                  [disabled]="isGenerating"></textarea>
                <div class="input-glow"></div>
              </div>
              <p class="input-hint">
                詳細描述讓AI能創造出更獨特強大的英雄
              </p>
            </div>
          </ng-container>
          <button 
            (click)="mode==='normal' ? generateCharacter() : generateAdvancedCharacter()"
            [disabled]="(mode==='normal' ? !characterPrompt.trim() : !advancedName.trim() || !advancedPrompt.trim()) || isGenerating"
            class="magic-button"
            [class.disabled]="(mode==='normal' ? !characterPrompt.trim() : !advancedName.trim() || !advancedPrompt.trim()) || isGenerating">
            <div class="button-glow"></div>
            <div class="button-content">
              <span *ngIf="!isGenerating" class="button-text">
                <span class="button-icon">{{ mode==='normal' ? '◉' : '✦' }}</span>
                {{ mode==='normal' ? '開始召喚' : '高級召喚' }}
              </span>
              <span *ngIf="isGenerating" class="button-loading">
                <span class="loading-icon">◉</span>
                召喚進行中...
              </span>
            </div>
          </button>
          <div *ngIf="generatedCharacter && !isGenerating" class="success-notification">
            <div class="success-content">
              <div class="success-icon">✦</div>
              <h3 class="success-title">英雄召喚成功！</h3>
              <p class="success-message">
                你的英雄已經誕生，準備踏上冒險之旅！
              </p>
            </div>
            <button 
              (click)="saveCharacter()"
              class="battle-button">
              <div class="battle-button-bg"></div>
              <span class="battle-button-text">
                <span class="battle-icon">◈</span>
                前往戰場
              </span>
            </button>
          </div>
          <!-- 召喚指南 -->
          <div class="guide-scroll">
            <div class="scroll-header">
              <span class="scroll-icon">◎</span>
              <span class="scroll-title">召喚師指南</span>
            </div>
            <div class="scroll-content">
              <div class="guide-item">
                <span class="guide-icon">◉</span>
                <span class="guide-text">普通召喚：快速創造隨機英雄</span>
              </div>
              <div class="guide-item">
                <span class="guide-icon">✦</span>
                <span class="guide-text">高級召喚：客製化獨特戰士</span>
              </div>
              <div class="guide-item">
                <span class="guide-icon">◈</span>
                <span class="guide-text">描述越詳細，英雄越強大</span>
              </div>
            </div>
          </div>
          </div>
        </div>
        <!-- 角色預覽 -->
        <div class="character-preview-container">
          <h2 class="preview-title">角色預覽</h2>
          <div class="preview-content">
            <div *ngIf="!generatedCharacter" class="empty-preview">
              <div class="empty-icon">◉</div>
              <h3>等待召喚</h3>
              <p>完成召喚後，你的英雄將在此顯現</p>
            </div>
            <div *ngIf="generatedCharacter" class="character-display">
              <app-character-card [character]="generatedCharacter"></app-character-card>
            </div>
          </div>
        </div>
      </div>
      <!-- 快速召喚 & 注意事項 -->
      <div class="info-section">
        <div class="quick-summon">
          <h3 class="section-title">快速召喚</h3>
          <p class="section-subtitle">點擊範例快速開始召喚</p>
          <div class="quick-examples">
            <button 
              *ngFor="let example of examplePrompts"
              (click)="characterPrompt = example; mode='normal'; generateCharacter()"
              class="example-button"
              [disabled]="isGenerating">
              <span class="example-emoji">{{getExampleEmoji(example)}}</span>
              <span class="example-name">{{example}}</span>
            </button>
          </div>
        </div>
        
        <div class="game-info">
          <h3 class="section-title">遊戲說明</h3>
          <div class="info-content">
            <div class="info-item">
              <span class="info-icon">◉</span>
              <span class="info-text">每個英雄都有獨特的屬性和技能</span>
            </div>
            <div class="info-item">
              <span class="info-icon">✦</span>
              <span class="info-text">高級召喚可創造更強大的英雄</span>
            </div>
            <div class="info-item">
              <span class="info-icon">◈</span>
              <span class="info-text">英雄生成後可立即參與戰鬥</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 