<div class="container mx-auto px-4 py-8">
  <!-- ç„¡è§’è‰²æ™‚çš„æç¤º -->
  <div *ngIf="!playerCharacter" class="text-center">
    <div class="rpg-card p-8 max-w-md mx-auto">
      <div class="text-6xl mb-4">ğŸ­</div>
      <h2 class="text-2xl font-bold text-white mb-4">å°šæœªé¸æ“‡è§’è‰²</h2>
      <p class="text-gray-300 mb-6">ä½ éœ€è¦ä¸€å€‹è§’è‰²æ‰èƒ½é€²å…¥æˆ°é¬¥ï¼</p>
      <a routerLink="/create" class="rpg-button inline-block">
        å‰µå»ºè§’è‰²
      </a>
    </div>
  </div>

  <!-- æˆ°é¬¥å ´æ™¯ -->
  <div *ngIf="playerCharacter && opponent" class="battle-scene">
    <!-- è¡€é‡æ¢ -->
    <div class="health-bars">
      <div class="health-bar player" *ngIf="playerCharacter">
        <div class="name">{{ playerCharacter.name }}</div>
        <div class="bar-container">
          <div class="bar" [style.width.%]="playerHealth">
            <div class="health-text">HP: {{playerHealth}}%</div>
          </div>
        </div>
      </div>
      
      <div class="health-bar opponent" *ngIf="opponent">
        <div class="name">{{ opponent.name }}</div>
        <div class="bar-container">
          <div class="bar" [style.width.%]="opponentHealth">
            <div class="health-text">HP: {{opponentHealth}}%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- è§’è‰²é¡¯ç¤º -->
    <div class="characters-display">
      <div class="character player">
        <img [src]="playerCharacter.image_url | mediaUrl" 
             [alt]="playerCharacter.name"
             [class.shake-animation]="isPlayerBeingAttacked">
      </div>
      <div class="character opponent">
        <img [src]="opponent.image_url | mediaUrl" 
             [alt]="opponent.name"
             [class.shake-animation]="isOpponentBeingAttacked">
      </div>
    </div>

    <!-- æˆ°é¬¥æ§åˆ¶ -->
    <div class="battle-controls" *ngIf="!battleStarted">
      <button (click)="startBattle()" class="rpg-button text-xl px-8 py-4" [disabled]="isLoading">
        <mat-icon>sports_kabaddi</mat-icon>
        é–‹å§‹æˆ°é¬¥
      </button>
      <button (click)="findNewOpponent()" class="rpg-button text-xl px-8 py-4" [disabled]="isLoading">
        <mat-icon>refresh</mat-icon>
        æ›´æ›å°æ‰‹
      </button>
    </div>

    <!-- æˆ°é¬¥çµæŸå¾Œçš„æ§åˆ¶æŒ‰éˆ• -->
    <div class="battle-controls" *ngIf="battleResult && !showResultOverlay">
      <button (click)="resetBattle()" class="rpg-button text-xl px-8 py-4">
          <mat-icon>replay</mat-icon>
          å†ä¾†ä¸€å ´
      </button>
    </div>
  </div>

  <!-- å°‹æ‰¾å°æ‰‹ä»‹é¢ -->
  <div *ngIf="playerCharacter && !opponent && !battleResult" class="text-center">
    <div class="rpg-card p-8 max-w-md mx-auto">
      <div class="text-6xl mb-4 animate-bounce-slow">âš”ï¸</div>
      <h2 class="text-2xl font-bold text-white mb-4">æº–å‚™å¥½æˆ°é¬¥äº†å—ï¼Ÿ</h2>
      <p class="text-gray-300 mb-6">
        é€²å…¥ç«¶æŠ€å ´ï¼Œå°‹æ‰¾ä¸€å€‹å€¼å¾—ä¸€æˆ°çš„å°æ‰‹ã€‚
        å‹åˆ©å¸¶ä¾†æ¦®è€€ï¼Œå¤±æ•—å¸¶ä¾†æ™ºæ…§ï¼
      </p>
      <button (click)="findNewOpponent()" class="rpg-button" [disabled]="isLoading">
        <mat-icon>search</mat-icon>
        å°‹æ‰¾å°æ‰‹
      </button>
    </div>
  </div>

  <!-- è¼‰å…¥ä¸­å‹•ç•« -->
  <div *ngIf="isLoading" class="text-center mb-8">
    <div class="text-4xl animate-spin">âš”ï¸</div>
  </div>

  <!-- æˆ°é¬¥é€²è¡Œä¸­ä»‹é¢ -->
  <div *ngIf="battleStarted && !battleResult" class="battle-in-progress-overlay">
    <div class="content">
      <div class="spinner">âš”ï¸</div>
      <p>AI æ­£åœ¨ä¸»å°æˆ°é¬¥...</p>
    </div>
  </div>

  <!-- æˆ°é¬¥è¨˜éŒ„ -->
  <app-battle-log *ngIf="battleResult" [battleResult]="battleResult" [currentRound]="currentRound"></app-battle-log>

  <!-- æˆ°é¬¥çµæœå½ˆçª— -->
  <div class="battle-result-overlay" *ngIf="battleResult && showResultOverlay" [@fadeInOut]>
    <div class="battle-result-container beautiful-overlay">
      <div class="rpg-card result-card" 
           [class.victory]="battleResult.winner.id === playerCharacter?.id"
           [class.defeat]="battleResult.winner.id !== playerCharacter?.id">
        <div class="result-icon big-icon" 
             [class.animate-bounce]="battleResult.winner.id === playerCharacter?.id">
          <mat-icon class="result-emoji">
            {{battleResult.winner.id === playerCharacter?.id ? 'emoji_events' : 'sentiment_very_dissatisfied'}}
          </mat-icon>
        </div>
        <h2 class="result-title">
          {{battleResult.winner.id === playerCharacter?.id ? 'å‹åˆ©ï¼' : 'å¤±æ•—ï¼'}}
        </h2>
        <p class="result-message">
          {{battleResult.winner.id === playerCharacter?.id ? 
            'ä½ çš„è‹±é›„ç²å¾—äº†å…‰æ¦®çš„å‹åˆ©ï¼' : 
            'ä½ çš„è‹±é›„å¥®æˆ°åˆ°åº•ï¼Œä½†é‚„æ˜¯è½æ•—äº†ã€‚'}}
        </p>
        <div class="action-buttons">
          <button mat-raised-button color="accent" (click)="resetBattle()">
            <mat-icon>replay</mat-icon>
            å†ä¾†ä¸€å ´
          </button>
          <button mat-raised-button color="primary" (click)="showResultOverlay = false">
            <mat-icon>visibility</mat-icon>
            æŸ¥çœ‹æˆ°å ±
          </button>
        </div>
      </div>
    </div>
  </div>
</div> 